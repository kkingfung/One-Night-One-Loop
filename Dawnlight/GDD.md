# Soul Reaper - Game Design Document

## One Night, One Loop

**Version**: 2.2.0
**Last Updated**: 2025-01-18
**Target Platform**: Windows (PC)
**Engine**: Unreal Engine 5.7
**Camera**: Top-Down (固定俯瞰視点)

---

## 0. 開発スコープ

### Demo/MVP スコープ（Phase 1 目標）
シンプルに始めて、段階的に機能追加。

| 項目 | Demo | Full Game |
|------|------|-----------|
| 動物タイプ | 4種（Tiger, Horse, Dog, Chicken） | 7種 |
| ウェーブ数 | 3 | 5-10 |
| 敵タイプ | Down Melee のみ | Melee + Ranged + Boss |
| リーパーモード | 基本版 | 拡張版（アップグレード可能） |
| アップグレードショップ | なし | あり |
| 魂融合 | なし | あり |
| ループ数 | 1ループ完結 | 5ループ+ |

---

## 1. コンセプト概要

### 1.1 ワンライナー
> 「夜に魂を集め、夜明けに力を解き放て」

### 1.2 ゲームの概要
プレイヤーは死神（Stylized Death）として、夜の墓地で動物の魂を収集する。夜明けと共に収集した魂がバフに変換され、襲い来るミニオンの群れと戦う。敵を倒すことでリーパーゲージが溜まり、満タンになるとリーパーモードを発動できる。

### 1.3 コアコンセプト
- **二相ゲームプレイ**: 夜（平和な収集）→ 夜明け（アクション戦闘）
- **魂＝パワー**: 集めた魂が直接戦闘力に影響
- **リーパーモード**: 戦闘のクライマックスとなるパワースパイク
- **ローグライト進行**: ループを重ねて永続的に強くなる

### 1.4 Core Fun
**「集めれば集めるほど強くなる。そしてその力を解き放つ瞬間。」**

---

## 2. ゲームフロー

### 2.1 1ループの流れ

```
┌─────────────────────────────────────────────────────────────────┐
│  NIGHT PHASE（夜フェーズ）- 2〜3分                              │
│  ─────────────────────────────────────                          │
│  • 動物が墓地を徘徊（敵なし、危険なし）                         │
│  • プレイヤーは動物を狩って魂を収穫                             │
│  • 攻撃で動物を倒す → 魂収集（戦闘チュートリアル）              │
│  • 異なる動物 = 異なる行動パターン + 異なる魂                   │
│  • タイマーが夜明けまでカウントダウン                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  DAWN TRANSITION（夜明け移行）- 5秒                             │
│  ─────────────────────────────────────                          │
│  • 画面が明るくなる演出                                         │
│  • 収集した魂が自動的にバフに変換                               │
│  • UI表示: "+15% DMG, +10% SPD, +20% DEF"                       │
│  • ミニオンがスポーン開始                                       │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  DAWN PHASE（夜明けフェーズ）- クリアまたは死亡まで             │
│  ─────────────────────────────────────────────────              │
│  • ウェーブ形式の戦闘                                           │
│  • 鎌攻撃で敵を倒す（Attack_A, B, C, D）                        │
│  • 敵撃破 → リーパーゲージ上昇                                  │
│  • ゲージ満タン → リーパーモード発動可能                        │
│  • 全ウェーブクリア = ループ完了                                │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  LOOP END（ループ終了）                                         │
│  ─────────────────────                                          │
│  • 勝利: 未使用の魂 + ボーナス魂を獲得                          │
│  • 死亡: 収集した魂の50%を失う、永続アップグレードは維持        │
│                                                                 │
│  → アップグレードショップ or 次のループ開始                     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. システム詳細

### 3.1 魂狩猟システム（Night Phase）

#### 狩猟の流れ
1. 動物がマップ上のランダムな位置にスポーン
2. 動物はidle/walkアニメーションで徘徊
3. プレイヤーが近づくと動物は逃走（runアニメーション）
4. プレイヤーが攻撃して動物を倒す
5. 死亡VFX再生 → 魂収集エフェクト → 魂がインベントリに追加

#### 戦闘チュートリアルとしての役割
- **敵がいない安全な環境**で攻撃操作を学べる
- **動物は攻撃してこない**ため失敗のリスクなし
- **ヒット確認**と**攻撃タイミング**を練習
- Dawn Phaseの本格戦闘への準備

#### リスク/リワード要素（Full Game）
Night Phaseをより緊張感のあるものにする追加要素（Demo後に実装）:

| 要素 | 効果 | 実装優先度 |
|------|------|-----------|
| Ghost Animal | 反撃してくるが2x魂ドロップ | 中 |
| 動物消失タイマー | 一定時間で動物が消える（急かす） | 低 |
| コンボボーナス | 連続キルで追加魂 | 高 |
| エリアボーナス | 特定エリアで特定魂が2倍 | 低 |

#### 魂タイプと効果

| 動物 | 魂タイプ | 夜明けバフ（1個あたり） | 行動パターン | 難易度 |
|------|----------|------------------------|-------------|--------|
| Tiger | Power Soul | +3% 攻撃ダメージ | 高速移動、積極的に逃走 | ★★★ |
| Horse | Speed Soul | +3% 移動速度 | 高速移動、直線的に逃走 | ★★★ |
| Dog | Guard Soul | +3% ダメージ軽減 | 中速、一定距離で停止 | ★★ |
| Deer | Spirit Soul | +3% クールダウン短縮 | 高速、ジグザグ逃走 | ★★★ |
| Kitty | Luck Soul | +3% 敵からの魂ドロップ率 | 低速、予測しにくい動き | ★★ |
| Chicken | Common Soul | +1% 全ステータス | 低速、パニック逃走 | ★ |
| Penguin | Rare Soul | +5% ランダムステータス | 低速、滑る動き | ★（レア）|

#### 収集例
```
収集: Tiger x5, Horse x3, Dog x2, Chicken x10

夜明けバフ:
├─ +15% 攻撃ダメージ（Tiger 5個）
├─ +9% 移動速度（Horse 3個）
├─ +6% ダメージ軽減（Dog 2個）
└─ +10% 全ステータス（Chicken 10個）
```

#### スポーンルール
- Night開始時: 各動物タイプ 3〜5体スポーン
- 30秒ごと: 追加で 2〜3体スポーン
- Rare（Penguin）: 5%の確率で出現
- エリア傾向: 特定エリアに特定の動物が出やすい

---

### 3.2 戦闘システム（Dawn Phase）

#### 基本操作

| 入力 | アクション | アニメーション | 説明 |
|------|-----------|---------------|------|
| 左クリック | 通常攻撃 | Attack_A, B | 素早い鎌スイング |
| 右クリック | 強攻撃 | Attack_C, D | 遅いが強力な一撃 |
| Q | 特殊攻撃 | Staff_Attack | 長射程の杖攻撃 |
| WASD | 移動 | Walk 4方向 | 8方向移動 |
| Space | リーパーモード | Roar | ゲージ満タン時のみ |

#### ウェーブ構成（ループ1）

| Wave | 敵構成 | 説明 |
|------|--------|------|
| 1 | Down Melee x5 | 導入、基本敵のみ |
| 2 | Down Melee x8 | 数が増加 |
| 3 | Down Melee x5 + Ranged x3 | 遠距離敵登場 |
| 4 | Down Melee x10 + Ranged x5 | 混合戦 |
| 5 | **Dusk Minion x1** | ミニボス戦 |

#### 難易度スケーリング

| ループ | 敵HP | 敵ダメージ | ウェーブ数 |
|--------|------|-----------|-----------|
| 1 | 100% | 100% | 5 |
| 2 | 120% | 110% | 6 |
| 3 | 150% | 120% | 7 |
| 4 | 180% | 130% | 8 |
| 5 | 200% | 140% | 10（ボス戦） |

#### 死亡とリスポーン

**Night Phase中の死亡**（Ghost Animal等から）:
- 即座に同位置でリスポーン
- 収集済み魂の10%を失う
- 3秒間の無敵時間

**Dawn Phase中の死亡**:
- ループ失敗
- 収集した魂の50%を失う
- 永続アップグレードは維持
- アップグレードショップ or 新ループ開始を選択

**Demo版**: Night Phase死亡なし（Ghost Animalなし）

---

### 3.3 リーパーモード

#### 発動条件
1. 敵を倒す → リーパーエナジー獲得
2. リーパーゲージが100%に到達
3. Spaceキーで発動
4. "Roar"アニメーション再生
5. 10秒間リーパーモード持続

#### リーパーモード効果

| 効果 | 値 |
|------|-----|
| ダメージ倍率 | 2.0x |
| 攻撃速度 | 1.5x |
| 移動速度 | 1.3x |
| ビジュアル | 発光オーラ（マテリアル変更） |
| サウンド | 低音化、エコー |

#### 実装概要
```cpp
void AReaperCharacter::ActivateReaperMode()
{
    // 既存のRoarアニメーション再生
    PlayAnimMontage(RoarMontage);

    // マテリアルオーバーレイ適用（発光効果）
    ApplyReaperMaterialOverlay();

    // ステータスバフ
    DamageMultiplier = 2.0f;
    AttackSpeedMultiplier = 1.5f;
    MoveSpeedMultiplier = 1.3f;

    // タイマー設定
    GetWorldTimerManager().SetTimer(
        ReaperModeTimer, this,
        &AReaperCharacter::DeactivateReaperMode,
        10.0f, false);
}
```

---

### 3.4 アップグレードショップ

#### 通貨システム
- **収集した魂**: バフに使用されなかった分が通貨になる
- **勝利時**: 100%維持 + ボーナス魂
- **死亡時**: 50%維持

#### 永続アップグレード

**基本ステータス:**
| アップグレード | コスト | 効果 |
|---------------|--------|------|
| 基礎ダメージ +5 | Common x10 | 永続 |
| 最大HP +20 | Common x10 | 永続 |
| 基礎速度 +3% | Common x15 | 永続 |

**魂効率:**
| アップグレード | コスト | 効果 |
|---------------|--------|------|
| Tiger Mastery | Tiger x5 | Tiger魂が+4%に（+3%から） |
| Horse Mastery | Horse x5 | Horse魂が+4%に |
| Dog Mastery | Dog x5 | Dog魂が+4%に |

**アビリティ解放:**
| アップグレード | コスト | 効果 |
|---------------|--------|------|
| ダッシュ | Rare x1 | 回避ダッシュ解放 |
| 魂爆発 | Rare x2 | 新AoE攻撃解放 |
| 延長リーパー | Rare x3 | リーパーモード15秒に |

#### 魂融合
```
Tiger x5 + Dog x5 = "狂戦士の魂"（ライフスティール解放）
Horse x5 + Deer x5 = "疾風の魂"（ダブルダッシュ解放）
各Common x5 = Rare x1
```

---

## 4. キャラクターとアセット

### 4.1 プレイヤー: Stylized Death

**アセット**: `Stylized_Death`

| アニメーション | 用途 |
|---------------|------|
| idle_B | 待機 |
| Walk, Walk_back, Walk_Left, Walk_Right | 移動 |
| Attack_A, Attack_B | 通常攻撃 |
| Attack_C, Attack_D | 強攻撃 |
| Staff_Attack_A, Staff_Attack_B | 特殊攻撃 |
| Roar | リーパーモード発動 |
| Spawn | リスポーン |
| die_A, die_B | 死亡 |

**装備**: `SM_Stylized_Scythe`（鎌）

### 4.2 収集対象: 動物の魂

**アセット**: `Animals_Free`

| 動物 | メッシュ | アニメーション |
|------|---------|---------------|
| Tiger | SKM_Tiger_001 | idle, walk, run |
| Horse | SKM_Horse_001 | idle, walk, run, eat |
| Dog | SKM_Dog_001 | idle, walk, run |
| Deer | SKM_Deer_001 | idle, walk, run |
| Kitty | SKM_Kitty_001 | idle, walk, run |
| Chicken | SKM_Chicken_001 | idle, walk, run |
| Penguin | SKM_Pinguin_001 | idle, walk, run |

### 4.3 敵: Paragon Minions

| タイプ | アセット | 役割 |
|--------|---------|------|
| Down Melee | ParagonMinions/Down_Minions/Melee | 基本近接敵 |
| Down Ranged | ParagonMinions/Down_Minions/Ranged | 基本遠距離敵 |
| Dusk Minion | ParagonMinions/Dusk_Minions | ミニボス |
| Prime Helix | ParagonMinions/Prime_Helix | ボス |

**利用可能なアニメーション（Melee）:**
- 攻撃: Attack_A 〜 E
- 死亡: Death_A 〜 E
- ヒットリアクト: Front, Back, Left, Right
- 移動: Jog各種
- その他: Stun, KnockUp

### 4.4 環境: Necropolis

**アセット**: `Necropolis`

利用コンテンツ:
- Placeables（墓石、建造物）
- Foliage（植物）
- Landscape（地形）
- VFX（霧など）
- Audio（環境音）

### 4.5 エフェクト

| 用途 | アセットパック |
|------|---------------|
| 魂収集 | Magic_Effects |
| 戦闘ヒット | Realistic_Starter_VFX_Pack_Vol2/Hit |
| 爆発 | Realistic_Starter_VFX_Pack_Vol2/Explosion |
| 火炎 | Realistic_Starter_VFX_Pack_Vol2/Fire |
| リーパーモード | Magic_Effects + カスタムマテリアル |

---

## 5. UI/UX

### 5.1 Night Phase HUD

```
┌────────────────────────────────────────────────────┐
│  NIGHT 1                          TIME: 2:45      │
│                                                    │
│                                                    │
│                 [GAMEPLAY AREA]                    │
│                                                    │
│                                                    │
│  ┌──────────────────────────────────────────────┐  │
│  │ Tiger:5  Horse:3  Dog:2  Deer:0  Cat:1  x10  │  │
│  └──────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────┘
```

### 5.2 Dawn Phase HUD

```
┌────────────────────────────────────────────────────┐
│  WAVE 3/10                       Enemies: 8       │
│                                                    │
│  HP: ████████████░░░░░░  (75%)                    │
│  REAPER: ██████████░░░░  (70%)  [SPACE to activate]│
│                                                    │
│                 [GAMEPLAY AREA]                    │
│                                                    │
│  BUFFS: +15% DMG | +9% SPD | +6% DEF              │
│                                                    │
└────────────────────────────────────────────────────┘
```

### 5.3 アップグレードショップUI

```
┌────────────────────────────────────────────────────┐
│                  SOUL SHOP                         │
│  ──────────────────────────────                    │
│  Your Souls: Common:45 Tiger:3 Horse:2 Rare:1     │
│                                                    │
│  [STATS]           [ABILITIES]      [FUSION]      │
│  ┌──────────┐      ┌──────────┐    ┌──────────┐   │
│  │ DMG +5   │      │ Dash     │    │ Berserker│   │
│  │ Cost: 10 │      │ Cost: 1R │    │ 5T + 5D  │   │
│  │ [BUY]    │      │ [BUY]    │    │ [FUSE]   │   │
│  └──────────┘      └──────────┘    └──────────┘   │
│                                                    │
│           [START NEXT LOOP]                        │
└────────────────────────────────────────────────────┘
```

---

## 6. 技術仕様

### 6.1 UE5システム使用

| システム | 用途 |
|---------|------|
| GAS | アビリティ、バフ/デバフ管理 |
| Enhanced Input | 入力処理 |
| Gameplay Tags | 状態管理（Night/Dawn/Reaper等） |
| Data Assets | 魂定義、敵定義、アップグレード定義 |
| AI (Behavior Trees) | 敵AI、動物AI |
| Niagara | VFX |
| UMG | UI |

### 6.2 C++実装領域

| システム | 説明 |
|---------|------|
| SoulReaperGameMode | フェーズ管理（Night/Dawn切り替え） |
| SoulCollectionSubsystem | 魂収集、インベントリ管理 |
| SoulBuffSystem | 魂→バフ変換 |
| WaveSpawnerSubsystem | 敵ウェーブスポーン |
| ReaperModeComponent | リーパーモード管理 |
| UpgradeSubsystem | 永続アップグレード、セーブ/ロード |
| CombatComponent | 攻撃、ダメージ処理 |

### 6.3 BP実装領域

| 内容 | 説明 |
|------|------|
| UI Widgets | 全てのHUD、メニュー |
| 敵AI調整 | Behavior Tree詳細 |
| VFX演出 | Niagara連携 |
| アニメーションBP | Animation Blueprint |
| レベルデザイン | Necropolis配置 |

---

## 7. 開発マイルストーン

### Phase 1: コア基盤（MVP）
- [ ] プレイヤーキャラクター（Stylized Death）セットアップ
- [ ] 基本移動と入力（Enhanced Input）
- [ ] フェーズ管理システム（Night/Dawn切り替え）
- [ ] 基本的なHUD

### Phase 2: Night Phase
- [ ] 動物スポーンシステム
- [ ] 動物AI（徘徊）
- [ ] 魂収集メカニクス
- [ ] 魂インベントリUI
- [ ] 収集VFX

### Phase 3: Dawn Phase - Combat
- [ ] 基本攻撃システム（GAS）
- [ ] 敵AI（追跡、攻撃）
- [ ] ウェーブスポナー
- [ ] ダメージシステム
- [ ] 戦闘VFX/ヒットリアクト

### Phase 4: Core Loop Integration
- [ ] 魂→バフ変換システム
- [ ] リーパーモード
- [ ] ループ完了/失敗処理
- [ ] 基本セーブシステム

### Phase 5: Meta Progression
- [ ] アップグレードショップUI
- [ ] 永続アップグレードシステム
- [ ] 魂融合システム
- [ ] 難易度スケーリング

### Phase 6: Polish
- [ ] サウンド実装
- [ ] 追加VFX
- [ ] バランス調整
- [ ] バグ修正
- [ ] ビルド

---

## 8. 用語集

| 用語 | 定義 |
|------|------|
| Night Phase | 夜フェーズ。魂を収集する平和な時間 |
| Dawn Phase | 夜明けフェーズ。敵と戦うアクション時間 |
| Soul | 魂。収集対象でありバフの源、通貨 |
| Loop | 1回のNight→Dawnサイクル |
| Wave | 敵の出現単位 |
| Reaper Mode | リーパーモード。パワースパイク状態 |
| Reaper Gauge | 敵撃破で溜まるゲージ |
| Minion | 敵キャラクター（Paragonアセット） |
| Buff | 収集した魂から得られる一時的強化 |
| Upgrade | ループ間で購入する永続強化 |
| Soul Fusion | 魂を組み合わせて特殊効果を得る |

---

## 9. マップ/レベル

### 9.1 使用アセット
**Necropolis** パックの `Demo_Necropolis.umap` をベースに使用。

### 9.2 マップ構成
- **中央エリア**: スポーン地点、Dawn Phase戦闘エリア
- **周辺エリア**: 動物狩猟エリア（Night Phase）
- **境界**: 見えない壁 or 霧で制限

### 9.3 Demo版マップ
- 単一エリア（中〜小サイズ）
- 動物スポーンポイント x 8-10
- 敵スポーンポイント x 4

---

**Document Status**: Confirmed (v2.2.0)
**Game Identity**: Power Fantasy - "Collect souls, unleash power"
**Next Step**: Refactor existing C++ code for Soul Reaper systems
